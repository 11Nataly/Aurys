# .github/workflows/deploy.yml
name: Despliegue Continuo (CD)

# 1. ¬øCu√°ndo se ejecuta el workflow?
on:
  push:
    branches:
      - deploy  # Ejecutar solo cuando se haga push a la rama 'main'
  
  workflow_dispatch: # Permite ejecutar el workflow manualmente desde la interfaz de GitHub

# 2. Definici√≥n de los "jobs" (tareas)
jobs:
  build_and_deploy:
    # El entorno donde se ejecutar√° (puedes usar ubuntu-latest, windows-latest, etc.)
    runs-on: ubuntu-latest

    # 3. Definici√≥n de los pasos
    steps:
      - name: ‚¨áÔ∏è Checkout del C√≥digo
        uses: actions/checkout@v4
        
      # --- Configuraci√≥n del Entorno (ej. Node.js o Python) ---
      
      # Si es una aplicaci√≥n Node.js/Frontend:
      - name: ‚öôÔ∏è Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Ajusta la versi√≥n seg√∫n necesites

      # Si es una aplicaci√≥n Python:
      # - name: ‚öôÔ∏è Configurar Python
      #   uses: actions/setup-python@v5
      #   with:
      #     python-version: '3.11' # Ajusta la versi√≥n
      # - name: üì¶ Instalar dependencias de Python
      #   run: pip install -r requirements.txt
          
      # --- Preparaci√≥n y Pruebas ---
      
      - name: üì¶ Instalar Dependencias (Node.js/JS)
        # Ajusta el comando seg√∫n tu gestor de paquetes (npm install o yarn install)
        run: npm install 

      - name: üß™ Ejecutar Pruebas (Opcional)
        # Este paso detendr√° el despliegue si las pruebas fallan
        run: npm test

      - name: üèóÔ∏è Construir el Proyecto (Build)
        # Genera los archivos est√°ticos o la distribuci√≥n final
        run: npm run build 

      # --- Despliegue (Adaptar seg√∫n la plataforma) ---

      # Ejemplo de Despliegue a Servidor usando SSH (scp)
      # Nota: Necesitas configurar SECRETs en GitHub (ver la secci√≥n de abajo)
      - name: üö¢ Despliegue por SSH y SCP
        uses: appleboy/scp-action@v0.1.7
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          key: ${{ secrets.SSH_KEY }}
          port: 22 # O el puerto SSH que uses
          source: "dist/" # El directorio que gener√≥ tu build (ej. build, dist, public)
          target: "/var/www/html/mi-app/" # El directorio de destino en tu servidor

      # ----------------------------------------------------------------------
      # Ejemplo alternativo: Despliegue a plataformas espec√≠ficas (Descomenta el que necesites)
      
      # EJEMPLO: Despliegue a Vercel
      # - name: üö¢ Despliegue a Vercel
      #   uses: amondnet/vercel-action@v25
      #   with:
      #     vercel-token: ${{ secrets.VERCEL_TOKEN }}
      #     vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
      #     vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
      #     vercel-args: '--prod' # Despliegue a producci√≥n

      # EJEMPLO: Despliegue a AWS S3 (para sitios est√°ticos)
      # - name: üö¢ Despliegue a S3
      #   uses: jakejarvis/s3-upload-action@v2
      #   with:
      #     aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
      #     aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      #     aws-region: 'us-east-1'
      #     source-dir: 'build'
      #     dest-dir: ''
      #     s3-bucket: ${{ secrets.S3_BUCKET_NAME }}